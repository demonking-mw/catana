# Visualization Architecture

## How It Works - Visual Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     INPUT: game_state.json                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Parse JSON / Pydantic Model  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Meta  â”‚      â”‚   Map    â”‚     â”‚ Players  â”‚
    â”‚(turn, â”‚      â”‚ (tiles,  â”‚     â”‚ (stats,  â”‚
    â”‚phase) â”‚      â”‚ nodes,   â”‚     â”‚resources)â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”˜      â”‚ edges)   â”‚     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â”‚
        â”‚               â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                â”‚
                â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Display Header  â”‚  â”‚ build_tile_position_ â”‚
    â”‚ & Legend        â”‚  â”‚ map()                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                         {0:(x,y), 1:(x,y), ...}
                                    â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                   â”‚                   â”‚
                â–¼                   â–¼                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  draw_board   â”‚  â”‚ get_vertex_pos  â”‚ â”‚ get_edge_pos â”‚
        â”‚  (hexes)      â”‚  â”‚ (settlements)   â”‚ â”‚ (roads)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                   â”‚                  â”‚
                â”‚                   â”‚                  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Canvas.render() â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ ASCII Board     â”‚
                  â”‚ with colored    â”‚
                  â”‚ settlements,    â”‚
                  â”‚ cities, roads   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ draw_player_    â”‚
                  â”‚ stats()         â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚     Statistics Table         â”‚
            â”‚ Turn | Phase | Current       â”‚
            â”‚ Player | VP | Army | Road... â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Position Calculation Details

### Tile Position Map
```
build_tile_position_map() creates:

Row 0: [0, 1, 2, 3]           x: 26, 42, 58, 74
Row 1: [4, 5, 6, 7, 8]        x: 18, 34, 50, 66, 82
Row 2: [9,10,11,12,13,14]     x: 10, 26, 42, 58, 74, 90
Row 3: [15,16,17,18,19,20,21] x:  2, 18, 34, 50, 66, 82, 98
Row 4: [22,23,24,25,26,27]    x: 10, 26, 42, 58, 74, 90
Row 5: [28,29,30,31,32]       x: 18, 34, 50, 66, 82
Row 6: [33,34,35,36]          x: 26, 42, 58, 74

Each tile stores its center coordinate (x, y)
```

### Vertex Position (Settlement/City)
```
Node key: "5_6_11"
         Tile 5 at (34, 9)
         Tile 6 at (50, 9)
         Tile 11 at (42, 14)
         
Vertex = average of 3 tiles
       = ((34+50+42)/3, (9+9+14)/3)
       = (42, 10.7)
       â‰ˆ (42, 11)

Draw settlement at (42, 11)
```

### Edge Position (Road)
```
Edge key: "5_6"
         Tile 5 at (34, 9)
         Tile 6 at (50, 9)
         
Edge = midpoint of 2 tiles
     = ((34+50)/2, (9+9)/2)
     = (42, 9)

Î”x = 50-34 = 16 (horizontal)
Î”y = 9-9 = 0

Since |Î”x| > |Î”y|, draw horizontal road: â•
```

## Data Structure Flow

```
JSON/Dict Input:
{
  "map": {
    "nodes": {
      "5_6_11": [0, 1]  â”€â”€â”
    },                    â”‚
    "edges": {            â”‚
      "5_6": 0  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    }                     â”‚
  }                       â”‚
}                         â”‚
                          â”‚
                          â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Parse node key "5_6_11"  â”‚
           â”‚ Split by "_" â†’ [5,6,11]  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Look up tile positions:  â”‚
           â”‚ 5 â†’ (34, 9)             â”‚
           â”‚ 6 â†’ (50, 9)             â”‚
           â”‚ 11 â†’ (42, 14)           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Calculate average:       â”‚
           â”‚ vertex_pos = (42, 11)    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Get building info:       â”‚
           â”‚ player_id = 0 (Red)      â”‚
           â”‚ type = 1 (Settlement)    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ canvas.draw_char(42, 11, â”‚
           â”‚   "â–²", PLAYER_COLORS[0]) â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Color Assignment

```
Player ID â†’ Color â†’ Terminal Code â†’ Display
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    0     â†’ Red   â†’ \033[38;5;196m â†’ ğŸ”´
    1     â†’ Blue  â†’ \033[38;5;33m  â†’ ğŸ”µ
    2     â†’ White â†’ \033[38;5;255m â†’ âšª
    3     â†’ Orangeâ†’ \033[38;5;208m â†’ ğŸŸ 

Symbols:
  Settlement â†’ â–²
  City       â†’ â– 
  Road H     â†’ â•
  Road V     â†’ â•‘
  Road Diag  â†’ / or \
```

## Canvas System

```
Canvas(width=130, height=45)
  â”‚
  â”œâ”€ grid[y][x] = (char, color)
  â”‚
  â”œâ”€ draw_char(x, y, char, color)
  â”‚    â””â”€ Sets grid position
  â”‚
  â”œâ”€ draw_text(x, y, text, color)
  â”‚    â””â”€ Multiple draw_char calls
  â”‚
  â””â”€ render()
       â””â”€ Outputs colored text to terminal

Drawing Order:
1. Hex borders and backgrounds
2. Hex content (resource, number)
3. Settlements/Cities (on top)
4. Roads (on top)
```

## Output Format

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ --- WATAN++ BOARD VISUALIZATION ---                   â”‚
â”‚                                                        â”‚
â”‚ Legend:                                                â”‚
â”‚   â–² = Settlement  â–  = City  â•/â•‘/\// = Road           â”‚
â”‚   â–  = Red  â–  = Blue  â–  = White  â–  = Orange          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚            [ASCII BOARD WITH HEXES]                   â”‚
â”‚              â–² â–  â• settlements/roads                  â”‚
â”‚                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ === PLAYER STATISTICS ===                             â”‚
â”‚                                                        â”‚
â”‚ Turn: 10 | Phase: main | Current: Player 2           â”‚
â”‚                                                        â”‚
â”‚ Player     VP    Army   Road   Resources    Dev Cards â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚   Red      5     3      7      8/8          2        â”‚
â”‚   Blue     6     4      9      6/6          1        â”‚
â”‚ â†’ White    3     1      5      5/5          0        â”‚
â”‚   Orange   4     2      6      7/7          1        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

This architecture ensures:
- âœ… Accurate positioning using tile topology
- âœ… Clear separation of concerns
- âœ… Extensible for future features
- âœ… Efficient O(1) position lookups
- âœ… Clean, readable code structure
